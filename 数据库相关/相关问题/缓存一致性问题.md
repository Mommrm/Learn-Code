# 数据库和缓存之间数据不一致的问题

## 问题一引入

当数据库进行了修改但是缓存没有及时更新，就会导致数据不一致的问题。

## 问题一解决

修改缓存数据时，可以采用以下两种方案：
方案一：先更新数据库数据，再进行缓存修改
方案二：更新缓存数据，再进行更新数据库数据

但是每次更新数据库数据都要修改缓存的数据，只要不读取数据，除了最后一次修改缓存，每次修改缓存的数据都是无用的，为了省去中间的修改缓存操作，改为删除缓存，等到查询缓存数据时才去重建缓存

方案一：先更新数据库，再删除缓存
方案二：先删除缓存，再更新数据库

## 问题二引入

方案一问题：
当线程一进行查询时，发现缓存已经过期，就要去数据库查询，并重建缓存(重建缓存这一过程比较快)，此时线程二去修改了数据库数据，并删除了对应的缓存数据(这里缓存原本为空)，而线程一已经查询到了旧的数据，出现了脏读，数据不一致的问题，重建的缓存也是旧数据

方案二：线程一打算更新数据，先进行缓存数据删除，然后再去数据库进行数据更新(这一过程相较比较慢)，此时线程二刚好进行查询数据，发现缓存不存在(刚刚删除)，然后去数据库进行查询数据，但线程一的数据库数据并没有更新完毕，线程二查询到的数据是旧的数据，导致数据不一致的问题

## 解决办法
选择方案一，因为方案一出现数据不一致的情况比较苛刻，在缓存重建的过程时才会出现数据不一致的问题，可以接受
